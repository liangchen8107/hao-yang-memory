<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>试卷管理 - 灏杨的初三日记</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --accent-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --success-color: #22c55e;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            border-bottom: 1px solid var(--border-color);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color) !important;
        }

        .nav-link {
            color: var(--text-secondary) !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary-color) !important;
        }

        .main-container {
            background: var(--bg-primary);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            padding: 40px;
            max-width: 1200px;
        }

        .upload-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed var(--border-color);
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .upload-area {
            text-align: center;
            padding: 40px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .upload-area.dragover {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-color);
        }

        .mobile-upload-hint {
            display: none;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .mobile-upload-hint h6 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .mobile-upload-hint ul {
            margin: 0;
            padding-left: 20px;
        }

        .mobile-upload-hint li {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .file-input {
            display: none;
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color), #667eea);
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
            color: white;
        }

        .btn-success-custom {
            background: linear-gradient(135deg, var(--success-color), #10b981);
            color: white;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
            color: white;
        }

        .btn-warning-custom {
            background: linear-gradient(135deg, var(--warning-color), #f59e0b);
            color: white;
        }

        .btn-warning-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
            color: white;
        }

        .exam-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .exam-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .exam-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.2rem;
        }

        .exam-date {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .exam-subject {
            background: linear-gradient(135deg, var(--primary-color), #667eea);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .exam-image {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .exam-image:hover {
            transform: scale(1.05);
        }

        .exam-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .score-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .score-good { background: linear-gradient(135deg, #17a2b8, #6f42c1); color: white; }
        .score-average { background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e74c3c); color: white; }

        .error-analysis {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .error-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .error-question {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .error-reason {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .error-solution {
            color: var(--success-color);
            font-size: 0.9rem;
        }

        .filter-section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .filter-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--border-color);
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .modal-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), #667eea);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                padding: 20px;
            }
            
            .upload-section {
                padding: 20px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .upload-icon {
                font-size: 3rem;
            }
            
            .upload-text {
                font-size: 1rem;
            }
            
            .exam-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .exam-stats {
                gap: 15px;
            }
            
            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .mobile-upload-hint {
                display: block !important;
                margin-top: 15px;
                padding: 15px;
            }
            
            .btn-custom {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .form-control, .form-select {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-graduation-cap me-2"></i>灏杨的初三日记
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home me-1"></i>首页
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="study.html">
                            <i class="fas fa-book me-1"></i>学习记录
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="exams.html">
                            <i class="fas fa-file-alt me-1"></i>试卷管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="life.html">
                            <i class="fas fa-camera me-1"></i>生活记录
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="progress.html">
                            <i class="fas fa-chart-line me-1"></i>学习进度
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <div class="main-container">
        <!-- 试卷上传区域 -->
        <div class="upload-section">
            <h2 class="mb-4">
                <i class="fas fa-upload text-primary me-2"></i>上传试卷
            </h2>
            <div class="upload-area" onclick="document.getElementById('fileInput').click()" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    点击或拖拽上传试卷图片
                </div>
                <p class="text-muted mb-3">
                    支持 JPG、PNG 格式，单张图片不超过 10MB
                </p>
                <input type="file" id="fileInput" class="file-input" multiple accept="image/*" capture="environment">
                <button class="btn-custom btn-primary-custom">
                    <i class="fas fa-plus me-2"></i>选择文件
                </button>
            </div>
            
            <!-- 移动端上传提示 -->
            <div class="mobile-upload-hint" id="mobileHint">
                <h6><i class="fas fa-mobile-alt me-2"></i>手机上传提示</h6>
                <ul>
                    <li>点击"选择文件"按钮选择图片</li>
                    <li>可以直接拍照或从相册选择</li>
                    <li>建议在光线充足的环境下拍照</li>
                    <li>确保试卷内容清晰可见</li>
                    <li>可以一次选择多张试卷图片</li>
                </ul>
            </div>
            
            <!-- 上传进度 -->
            <div id="uploadProgress" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="text-center">
                    <span id="progressText">上传中...</span>
                </div>
            </div>
        </div>

        <!-- 试卷信息表单 -->
        <div class="upload-section" id="examForm" style="display: none;">
            <h3 class="mb-4">
                <i class="fas fa-edit text-primary me-2"></i>试卷信息
            </h3>
            <form id="examInfoForm">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="examTitle" class="form-label">试卷标题</label>
                        <input type="text" class="form-control" id="examTitle" placeholder="例如：数学第一次月考" required>
                    </div>
                    <div class="col-md-6">
                        <label for="examSubject" class="form-label">科目</label>
                        <select class="form-select" id="examSubject" required>
                            <option value="">请选择科目</option>
                            <option value="数学">数学</option>
                            <option value="语文">语文</option>
                            <option value="英语">英语</option>
                            <option value="物理">物理</option>
                            <option value="化学">化学</option>
                            <option value="生物">生物</option>
                            <option value="地理">地理</option>
                            <option value="历史">历史</option>
                            <option value="道德与法治">道德与法治</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="examDate" class="form-label">考试日期</label>
                        <input type="date" class="form-control" id="examDate" required>
                    </div>
                    <div class="col-md-4">
                        <label for="examScore" class="form-label">得分</label>
                        <input type="number" class="form-control" id="examScore" min="0" max="150" placeholder="120" required>
                    </div>
                    <div class="col-md-4">
                        <label for="totalScore" class="form-label">总分</label>
                        <input type="number" class="form-control" id="totalScore" min="0" max="150" placeholder="150" required>
                    </div>
                    <div class="col-12">
                        <label for="examNotes" class="form-label">备注</label>
                        <textarea class="form-control" id="examNotes" rows="3" placeholder="记录考试感受、重点错题等..."></textarea>
                    </div>
                </div>
                <div class="mt-4 text-end">
                    <button type="button" class="btn btn-secondary me-2" onclick="cancelUpload()">取消</button>
                    <button type="submit" class="btn-custom btn-success-custom">
                        <i class="fas fa-save me-2"></i>保存试卷
                    </button>
                </div>
            </form>
        </div>

        <!-- 筛选和搜索 -->
        <div class="filter-section">
            <h3 class="filter-title">
                <i class="fas fa-filter me-2"></i>筛选和搜索
            </h3>
            <div class="filter-controls">
                <div class="flex-grow-1">
                    <input type="text" class="form-control" id="searchInput" placeholder="搜索试卷标题...">
                </div>
                <div>
                    <select class="form-select" id="subjectFilter">
                        <option value="">所有科目</option>
                        <option value="数学">数学</option>
                        <option value="语文">语文</option>
                        <option value="英语">英语</option>
                        <option value="物理">物理</option>
                        <option value="化学">化学</option>
                        <option value="生物">生物</option>
                        <option value="地理">地理</option>
                        <option value="历史">历史</option>
                        <option value="道德与法治">道德与法治</option>
                    </select>
                </div>
                <div>
                    <select class="form-select" id="scoreFilter">
                        <option value="">所有分数</option>
                        <option value="excellent">优秀 (90%+)</option>
                        <option value="good">良好 (80-89%)</option>
                        <option value="average">一般 (70-79%)</option>
                        <option value="poor">需改进 (<70%)</option>
                    </select>
                </div>
                <div>
                    <input type="date" class="form-control" id="dateFilter">
                </div>
                <div>
                    <button class="btn-custom btn-primary-custom" onclick="applyFilters()">
                        <i class="fas fa-search me-1"></i>筛选
                    </button>
                </div>
            </div>
        </div>

        <!-- 试卷列表 -->
        <div id="examList">
            <h3 class="mb-4">
                <i class="fas fa-list me-2"></i>试卷列表
                <span class="badge bg-primary ms-2" id="examCount">0</span>
            </h3>
            <div id="examsContainer">
                <!-- 示例试卷 -->
                <div class="exam-card">
                    <div class="exam-header">
                        <div>
                            <div class="exam-title">数学第一次月考</div>
                            <div class="exam-date">2024年1月15日</div>
                        </div>
                        <div class="exam-subject">数学</div>
                    </div>
                    
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM2NDc0OGIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7mlK/ku5jkuI3mn6Xor6I8L3RleHQ+Cjwvc3ZnPg==" alt="试卷图片" class="exam-image" onclick="openImageModal(this.src)">
                    
                    <div class="exam-stats">
                        <div class="stat-item">
                            <i class="fas fa-star text-warning"></i>
                            <span>得分：120/150</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-percentage text-primary"></i>
                            <span>正确率：80%</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock text-secondary"></i>
                            <span>考试时长：120分钟</span>
                        </div>
                    </div>
                    
                    <div class="score-badge score-good">良好</div>
                    
                    <div class="error-analysis">
                        <h6 class="mb-3">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>错题分析
                        </h6>
                        <div class="error-item">
                            <div class="error-question">第15题：二次函数应用题</div>
                            <div class="error-reason">错误原因：建立函数关系式时忽略了定义域限制</div>
                            <div class="error-solution">解决方案：仔细分析题目条件，注意自变量的取值范围</div>
                        </div>
                        <div class="error-item">
                            <div class="error-question">第22题：几何证明题</div>
                            <div class="error-reason">错误原因：证明过程中逻辑不够严密</div>
                            <div class="error-solution">解决方案：加强几何证明的练习，注意证明的完整性</div>
                        </div>
                    </div>
                </div>

                <div class="exam-card">
                    <div class="exam-header">
                        <div>
                            <div class="exam-title">英语期中考试</div>
                            <div class="exam-date">2024年1月10日</div>
                        </div>
                        <div class="exam-subject">英语</div>
                    </div>
                    
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM2NDc0OGIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7mlK/ku5jkuI3mn6Xor6I8L3RleHQ+Cjwvc3ZnPg==" alt="试卷图片" class="exam-image" onclick="openImageModal(this.src)">
                    
                    <div class="exam-stats">
                        <div class="stat-item">
                            <i class="fas fa-star text-warning"></i>
                            <span>得分：135/150</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-percentage text-primary"></i>
                            <span>正确率：90%</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock text-secondary"></i>
                            <span>考试时长：120分钟</span>
                        </div>
                    </div>
                    
                    <div class="score-badge score-excellent">优秀</div>
                    
                    <div class="error-analysis">
                        <h6 class="mb-3">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>错题分析
                        </h6>
                        <div class="error-item">
                            <div class="error-question">第8题：语法选择题</div>
                            <div class="error-reason">错误原因：时态判断错误</div>
                            <div class="error-solution">解决方案：加强时态练习，注意时间状语</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 空状态 -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-file-alt"></i>
                <h3>还没有上传试卷</h3>
                <p>开始上传你的第一张试卷吧！</p>
                <button class="btn-custom btn-primary-custom" onclick="scrollToUpload()">
                    <i class="fas fa-upload me-2"></i>上传试卷
                </button>
            </div>
        </div>
    </div>

    <!-- 图片预览模态框 -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">试卷预览</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" class="modal-image" src="" alt="试卷图片">
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 自定义JavaScript -->
    <script>
        // 试卷数据
        let exams = [
            {
                id: 1,
                title: '数学第一次月考',
                subject: '数学',
                date: '2024-01-15',
                score: 120,
                totalScore: 150,
                percentage: 80,
                notes: '考试感觉不错，但几何证明题还需要加强',
                imageUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM2NDc0OGIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7mlK/ku5jkuI3mn6Xor6I8L3RleHQ+Cjwvc3ZnPg==',
                errors: [
                    {
                        question: '第15题：二次函数应用题',
                        reason: '建立函数关系式时忽略了定义域限制',
                        solution: '仔细分析题目条件，注意自变量的取值范围'
                    },
                    {
                        question: '第22题：几何证明题',
                        reason: '证明过程中逻辑不够严密',
                        solution: '加强几何证明的练习，注意证明的完整性'
                    }
                ]
            },
            {
                id: 2,
                title: '英语期中考试',
                subject: '英语',
                date: '2024-01-10',
                score: 135,
                totalScore: 150,
                percentage: 90,
                notes: '听力部分表现很好，阅读理解有待提高',
                imageUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM2NDc0OGIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7mlK/ku5jkuI3mn6Xor6I8L3RleHQ+Cjwvc3ZnPg==',
                errors: [
                    {
                        question: '第8题：语法选择题',
                        reason: '时态判断错误',
                        solution: '加强时态练习，注意时间状语'
                    }
                ]
            }
        ];

        let uploadedFiles = [];

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 设置今天的日期
            document.getElementById('examDate').value = new Date().toISOString().split('T')[0];
            
            // 渲染试卷列表
            renderExams();
            
            // 绑定事件
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('examInfoForm').addEventListener('submit', handleExamSubmit);
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 300));
            document.getElementById('subjectFilter').addEventListener('change', applyFilters);
            document.getElementById('scoreFilter').addEventListener('change', applyFilters);
            document.getElementById('dateFilter').addEventListener('change', applyFilters);
            
            // 设置拖拽上传
            setupDragAndDrop();
            
            // 检测移动端并显示提示
            detectMobileDevice();
        });

        // 处理文件选择
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            uploadedFiles = files;
            
            if (files.length > 0) {
                // 验证文件类型和大小
                const validFiles = files.filter(file => {
                    const isValidType = file.type.startsWith('image/');
                    const isValidSize = file.size <= 10 * 1024 * 1024; // 10MB
                    
                    if (!isValidType) {
                        showAlert('请选择图片文件（JPG、PNG格式）', 'warning');
                        return false;
                    }
                    
                    if (!isValidSize) {
                        showAlert('图片文件大小不能超过10MB', 'warning');
                        return false;
                    }
                    
                    return true;
                });
                
                if (validFiles.length > 0) {
                    uploadedFiles = validFiles;
                    // 显示上传进度
                    showUploadProgress();
                    
                    // 模拟上传过程
                    simulateUpload(validFiles);
                } else {
                    // 清空文件输入
                    e.target.value = '';
                }
            }
        }

        // 显示上传进度
        function showUploadProgress() {
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('examForm').style.display = 'block';
        }

        // 模拟上传过程
        function simulateUpload(files) {
            let progress = 0;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = progress + '%';
                progressText.textContent = `上传中... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    progressText.textContent = '上传完成！';
                    setTimeout(() => {
                        document.getElementById('uploadProgress').style.display = 'none';
                    }, 1000);
                }
            }, 200);
        }

        // 处理试卷信息提交
        function handleExamSubmit(e) {
            e.preventDefault();
            
            const formData = {
                id: Date.now(),
                title: document.getElementById('examTitle').value,
                subject: document.getElementById('examSubject').value,
                date: document.getElementById('examDate').value,
                score: parseInt(document.getElementById('examScore').value),
                totalScore: parseInt(document.getElementById('totalScore').value),
                notes: document.getElementById('examNotes').value,
                imageUrl: uploadedFiles.length > 0 ? URL.createObjectURL(uploadedFiles[0]) : '',
                errors: []
            };
            
            formData.percentage = Math.round((formData.score / formData.totalScore) * 100);
            
            // 添加到数组开头
            exams.unshift(formData);
            
            // 保存到本地存储
            localStorage.setItem('exams', JSON.stringify(exams));
            
            // 重新渲染
            renderExams();
            
            // 重置表单
            resetExamForm();
            
            // 显示成功消息
            showAlert('试卷保存成功！', 'success');
            
            // 滚动到试卷列表
            document.getElementById('examList').scrollIntoView({ behavior: 'smooth' });
        }

        // 重置试卷表单
        function resetExamForm() {
            document.getElementById('examInfoForm').reset();
            document.getElementById('examDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('examForm').style.display = 'none';
            document.getElementById('fileInput').value = '';
            uploadedFiles = [];
        }

        // 取消上传
        function cancelUpload() {
            resetExamForm();
            document.getElementById('uploadProgress').style.display = 'none';
        }

        // 渲染试卷列表
        function renderExams() {
            const examsContainer = document.getElementById('examsContainer');
            const emptyState = document.getElementById('emptyState');
            const examCount = document.getElementById('examCount');
            
            // 从本地存储加载数据
            const savedExams = localStorage.getItem('exams');
            if (savedExams) {
                exams = JSON.parse(savedExams);
            }
            
            if (exams.length === 0) {
                examsContainer.style.display = 'none';
                emptyState.style.display = 'block';
                examCount.textContent = '0';
                return;
            }
            
            examsContainer.style.display = 'block';
            emptyState.style.display = 'none';
            examCount.textContent = exams.length;
            
            // 渲染试卷卡片
            examsContainer.innerHTML = exams.map(exam => `
                <div class="exam-card">
                    <div class="exam-header">
                        <div>
                            <div class="exam-title">${exam.title}</div>
                            <div class="exam-date">${formatDate(exam.date)}</div>
                        </div>
                        <div class="exam-subject">${exam.subject}</div>
                    </div>
                    
                    ${exam.imageUrl ? `<img src="${exam.imageUrl}" alt="试卷图片" class="exam-image" onclick="openImageModal('${exam.imageUrl}')">` : ''}
                    
                    <div class="exam-stats">
                        <div class="stat-item">
                            <i class="fas fa-star text-warning"></i>
                            <span>得分：${exam.score}/${exam.totalScore}</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-percentage text-primary"></i>
                            <span>正确率：${exam.percentage}%</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock text-secondary"></i>
                            <span>考试时长：120分钟</span>
                        </div>
                    </div>
                    
                    <div class="score-badge score-${getScoreClass(exam.percentage)}">${getScoreLabel(exam.percentage)}</div>
                    
                    ${exam.errors && exam.errors.length > 0 ? `
                        <div class="error-analysis">
                            <h6 class="mb-3">
                                <i class="fas fa-exclamation-triangle text-warning me-2"></i>错题分析
                            </h6>
                            ${exam.errors.map(error => `
                                <div class="error-item">
                                    <div class="error-question">${error.question}</div>
                                    <div class="error-reason">错误原因：${error.reason}</div>
                                    <div class="error-solution">解决方案：${error.solution}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // 应用筛选
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const subjectFilter = document.getElementById('subjectFilter').value;
            const scoreFilter = document.getElementById('scoreFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            // 这里可以实现筛选逻辑
            // 目前只是重新渲染
            renderExams();
        }

        // 打开图片模态框
        function openImageModal(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            new bootstrap.Modal(document.getElementById('imageModal')).show();
        }

        // 工具函数
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function getScoreClass(percentage) {
            if (percentage >= 90) return 'excellent';
            if (percentage >= 80) return 'good';
            if (percentage >= 70) return 'average';
            return 'poor';
        }

        function getScoreLabel(percentage) {
            if (percentage >= 90) return '优秀';
            if (percentage >= 80) return '良好';
            if (percentage >= 70) return '一般';
            return '需改进';
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const container = document.querySelector('.main-container');
            container.insertBefore(alertDiv, container.firstChild);
            
            // 3秒后自动消失
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        function scrollToUpload() {
            document.querySelector('.upload-section').scrollIntoView({ behavior: 'smooth' });
        }

        // 设置拖拽上传
        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    // 模拟文件选择事件
                    const fileInput = document.getElementById('fileInput');
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: fileInput });
                }
            });
        }

        // 检测移动端设备
        function detectMobileDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            if (isMobile || isTouchDevice) {
                document.getElementById('mobileHint').style.display = 'block';
            }
        }

        // 显示上传状态
        function showUploadStatus(message, type = 'info') {
            const statusDiv = document.createElement('div');
            statusDiv.className = `alert alert-${type} alert-dismissible fade show`;
            statusDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const uploadSection = document.querySelector('.upload-section');
            uploadSection.insertBefore(statusDiv, uploadSection.firstChild);
            
            // 3秒后自动消失
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>

